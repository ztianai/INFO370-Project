import pandas as pd
import numpy as np

d = {0: [('2014-09-05', 0.0053492230084301049)], 3: [('2014-07-05', 0.0046605644546147979)], 39947: [('2013-12-27', 0.0068342604616905391), ('2014-01-07', 0.0087073409755676293), ('2014-01-11', 0.0099837085926730434)], 12: [('2013-12-27', 0.010931715542806194), ('2014-01-07', 0.008831248803163029), ('2014-01-11', 0.010847746795033869), ('2014-01-20', 0.010933028648099037), ('2014-01-28', 0.007976258505688066), ('2014-02-08', 0.0099270381727820656), ('2014-02-17', 0.0097683733585571062), ('2014-02-21', 0.0071090537961187965), ('2014-02-24', 0.012934831589154722), ('2014-03-03', 0.013119843963020829), ('2014-03-07', 0.010383994837044207), ('2014-03-10', 0.011421169795709304), ('2014-04-07', 0.012580568401667753), ('2014-04-16', 0.011703769612947964), ('2014-04-21', 0.010627410657822963), ('2014-04-28', 0.009286151024151635), ('2014-05-03', 0.0087134257825075469), ('2014-05-10', 0.010466122537015459), ('2014-05-17', 0.0094470828468698094), ('2014-05-24', 0.0088525346144687159), ('2014-05-29', 0.012090625068274673), ('2014-06-04', 0.0098241385754515749), ('2014-06-07', 0.010778104754338656), ('2014-06-11', 0.011303516685154225), ('2014-06-19', 0.011759899692706138), ('2014-06-24', 0.010517211284704583), ('2014-06-30', 0.0091123184515500954), ('2014-07-05', 0.010102974828375286), ('2014-07-20', 0.012630052399937343), ('2014-07-26', 0.011706394228271954), ('2014-07-30', 0.012417279118594584), ('2014-08-03', 0.010582571513228894), ('2014-08-09', 0.010711620352078668), ('2014-08-14', 0.011188009791158911), ('2014-08-22', 0.011015444151896944), ('2014-08-27', 0.0096271939702415807), ('2014-08-31', 0.013379183439540275), ('2014-09-05', 0.010675875455643205), ('2014-09-11', 0.010421949256768042), ('2014-09-15', 0.012584530493046697), ('2014-09-24', 0.010001156203029252), ('2014-09-26', 0.012845662963838338), ('2014-09-30', 0.0082282374653952634), ('2014-10-04', 0.0044773107777214254)], 271: [('2014-08-27', 0.0045883819047190062)], 21: [('2014-06-19', 0.011003227099413161)], 278: [('2014-08-14', 0.0078846819061601393), ('2014-08-22', 0.014953791238889576), ('2014-08-27', 0.0059216551806975659), ('2014-08-31', 0.016855356180155545), ('2014-08-31', 0.0090169607978190583), ('2014-09-05', 0.0072112943088329896), ('2014-09-11', 0.0071453515737689988), ('2014-09-15', 0.0073458899326859515), ('2014-09-24', 0.0065050184717198242), ('2014-09-26', 0.0059481604033719375), ('2014-09-30', 0.0064458188689194527), ('2014-10-04', 0.0053662287518610021), ('2014-10-08', 0.0073178321615948588), ('2014-10-11', 0.004910788496703053)], 25: [('2014-06-24', 0.0080083991798815674)], 26: [('2014-07-05', 0.0047330282227307403)], 543: [('2014-06-24', 0.0068334518701461781), ('2014-06-30', 0.0051395480347313192), ('2014-07-05', 0.0054157131960335626), ('2014-07-20', 0.0062303879212333435), ('2014-07-20', 0.01000752901703377), ('2014-07-26', 0.0064956545274110601), ('2014-07-30', 0.0059703508847639723)], 36645: [('2014-03-07', 0.009832203936753792), ('2014-03-10', 0.0075402375839719472), ('2014-04-07', 0.0080042487007321427), ('2014-04-16', 0.0074586987913478108)], 40: [('2014-06-30', 0.0098209747961718243), ('2014-07-05', 0.012665903890160183), ('2014-07-20', 0.014476935437415678), ('2014-07-26', 0.014566013182679347), ('2014-07-30', 0.016511341227505642), ('2014-08-03', 0.012422900543399961), ('2014-08-09', 0.011363367744244868), ('2014-08-14', 0.011742525263460863), ('2014-08-22', 0.011786326447668357), ('2014-08-27', 0.0095190907316487251), ('2014-08-31', 0.015263527567036222), ('2014-09-05', 0.011759262394059429), ('2014-09-11', 0.010941224700505611), ('2014-09-15', 0.011153835411099836), ('2014-09-24', 0.011895126879518138), ('2014-09-26', 0.013338060348223432), ('2014-09-30', 0.01131245331106912), ('2014-10-04', 0.011375968675185011), ('2014-10-08', 0.012275009365318787), ('2014-10-11', 0.0093886795589294622)], 45: [('2014-10-11', 0.0055584030586801128)], 820: [('2014-04-28', 0.0099931213696117394), ('2014-05-03', 0.0082457131402955703), ('2014-05-10', 0.0095718069646140366), ('2014-05-17', 0.0087168061324638235), ('2014-05-24', 0.0069625827326436273), ('2014-05-29', 0.0077560027091389747)], 58: [('2014-10-11', 0.0061506067490441621)], 63: [('2014-05-10', 0.0063207068249429878)], 31499: [('2014-08-09', 0.0090535479709719143)], 74: [('2014-07-20', 0.010727586015229837), ('2014-07-26', 0.0068893305593753671), ('2014-07-30', 0.0085915263046304931)], 334: [('2014-01-20', 0.0097925554775207292)], 80: [('2013-12-27', 0.01399608474017793), ('2014-01-07', 0.0065671148625561808), ('2014-01-11', 0.014686450869644558), ('2014-01-20', 0.02324762314070378), ('2014-01-28', 0.017830131144864411), ('2014-02-08', 0.021342920587924287), ('2014-02-17', 0.019256482568153818), ('2014-02-21', 0.017112241898287122), ('2014-02-24', 0.027009378768490289), ('2014-03-03', 0.022259152743086309), ('2014-03-07', 0.017625040335592125), ('2014-03-10', 0.019271684954985126), ('2014-04-07', 0.016215414644912766), ('2014-04-16', 0.015623252449987449), ('2014-04-21', 0.01584336215261184), ('2014-04-28', 0.017724415316416997), ('2014-05-03', 0.016858914785186266), ('2014-05-10', 0.015145497252609955), ('2014-05-17', 0.011563489885434933), ('2014-05-24', 0.011003299855985667), ('2014-05-29', 0.011623080116230802), ('2014-06-04', 0.011257966606306265), ('2014-06-07', 0.010727752850477225), ('2014-06-11', 0.01078565195014433), ('2014-06-19', 0.010127079886126555), ('2014-06-24', 0.0087091992382381522), ('2014-06-30', 0.0077737453561534994)], 86: [('2014-08-22', 0.0049654538707568337), ('2014-09-30', 0.0060228720833150236), ('2014-10-04', 0.0045591130452802822), ('2014-10-08', 0.006061194677724019), ('2014-10-11', 0.0048726935224691088)], 88: [('2014-02-08', 0.00960558316590885), ('2014-02-17', 0.0091611343691429172), ('2014-02-21', 0.0058462341060685737), ('2014-02-24', 0.012084746693508286), ('2014-03-03', 0.011744569057309756), ('2014-03-07', 0.0081413359148112298), ('2014-03-10', 0.0094782411694017063), ('2014-04-07', 0.010983857006390294), ('2014-04-16', 0.0095911758199970672), ('2014-04-21', 0.0087181937987864042), ('2014-04-28', 0.0096539666768572299), ('2014-05-03', 0.0076200715539600688), ('2014-05-10', 0.010197827865295033), ('2014-05-17', 0.0053910236432900592), ('2014-05-24', 0.0062935397664775454), ('2014-05-29', 0.0087828537720390648), ('2014-06-04', 0.0059608581058003983), ('2014-06-07', 0.0069541573888621594), ('2014-06-11', 0.0090402559914072814), ('2014-06-19', 0.0074022877462718772)], 604: [('2013-12-27', 0.01383133370806117), ('2014-01-07', 0.011200516658093247), ('2014-01-11', 0.011720579279352565), ('2014-01-20', 0.010509544125200474), ('2014-01-28', 0.0086533520934677262), ('2014-02-08', 0.010563603679813894), ('2014-02-17', 0.010004846234242439), ('2014-02-21', 0.0061816058926065015), ('2014-02-24', 0.0095736109575190759), ('2014-03-03', 0.0088746031903989483), ('2014-03-07', 0.0062858986769925781), ('2014-03-10', 0.0073900238371978491)], 356: [('2014-04-21', 0.0081775306174663182)], 101: [('2014-09-05', 0.013824468745415356), ('2014-09-11', 0.0077739481635565816), ('2014-09-15', 0.012671427374379695), ('2014-09-24', 0.0094065375022711131), ('2014-09-26', 0.01196722603009533), ('2014-09-30', 0.011177879333831348), ('2014-10-04', 0.0090909586680409452), ('2014-10-08', 0.018572071331024873), ('2014-10-11', 0.0057211724940433315)], 360: [('2014-02-24', 0.017018248238330706), ('2014-03-03', 0.012737712585457115), ('2014-03-07', 0.017947725072604066), ('2014-03-10', 0.014819448001418413), ('2014-04-07', 0.014266943935772887), ('2014-04-16', 0.014678798754315284), ('2014-04-21', 0.017711546538066069), ('2014-04-28', 0.01548408361357383), ('2014-05-03', 0.011103619609915509), ('2014-05-10', 0.011652405840406756), ('2014-05-17', 0.012321675264085735), ('2014-05-24', 0.012810093855010451), ('2014-05-29', 0.015129667256559832), ('2014-06-04', 0.013825968719994329), ('2014-06-07', 0.013913909433708922), ('2014-06-11', 0.012710062879008256), ('2014-06-19', 0.012776076299318609), ('2014-06-24', 0.0093057911094785156), ('2014-06-30', 0.0062347442036921712), ('2014-07-05', 0.0080968726163234174), ('2014-07-20', 0.0061975432160524709), ('2014-07-26', 0.0047459832742363641)], 107: [('2014-01-11', 0.0054656462368168216), ('2014-01-20', 0.0055912535770815206)], 60789: [('2014-02-08', 0.0089330654541609385), ('2014-02-17', 0.0071262998709617142)], 118: [('2014-08-31', 0.0099642348763526716), ('2014-09-05', 0.0068332374084481614), ('2014-09-11', 0.0077952050530663061), ('2014-09-15', 0.0095431396463917621), ('2014-09-24', 0.007077614257635069), ('2014-09-26', 0.0079925943433388491)], 121: [('2013-12-27', 0.0029945922896516966)], 378: [('2014-09-26', 0.0053572835421098249), ('2014-09-30', 0.0046304433800588825), ('2014-10-04', 0.0044991247157371208), ('2014-10-08', 0.0050523169501368627), ('2014-10-11', 0.0034250845015792097)], 138: [('2013-12-27', 0.015199736398348611), ('2014-01-07', 0.012341970585032686), ('2014-01-11', 0.015266873478864042), ('2014-01-20', 0.014023207790438055), ('2014-01-28', 0.0090471228324601541), ('2014-02-08', 0.010650311938246801), ('2014-02-17', 0.0080955467194497484), ('2014-02-21', 0.0085540507529303627), ('2014-02-24', 0.014785458884101833), ('2014-03-03', 0.012845187035396909), ('2014-03-07', 0.0098483381736043894), ('2014-03-10', 0.01027609779161167), ('2014-04-07', 0.010370002517493128), ('2014-04-16', 0.0097999497948298622), ('2014-04-21', 0.0095340159205997508), ('2014-04-28', 0.0092192754509324362), ('2014-05-03', 0.0084249017499741854), ('2014-05-10', 0.009264057194111195), ('2014-05-17', 0.0074934763497327738), ('2014-05-24', 0.008625740388649706), ('2014-05-29', 0.011055034847392455), ('2014-06-04', 0.01001424161774467), ('2014-06-07', 0.010190665875955289), ('2014-06-11', 0.010232623560288086), ('2014-06-11', 0.017991004497751123), ('2014-06-19', 0.016666067152444477)], 58007: [('2014-05-03', 0.0066785720793775174)], 152: [('2013-12-27', 0.0055569554009264818)], 153: [('2014-06-24', 0.0082767352617058362)], 409755: [('2013-12-27', 0.0052662182854263167)], 160: [('2014-08-03', 0.004822368832383267), ('2014-08-09', 0.0051802098423987001), ('2014-08-14', 0.0088616853573588155), ('2014-08-22', 0.005517661819017158)], 2216: [('2013-12-27', 0.00318260229100847)], 430: [('2014-01-28', 0.0064636026180952058)], 178: [('2014-05-24', 0.0048874155663996798), ('2014-05-29', 0.0076074370234427919)], 180: [('2014-05-29', 0.0098446614668676671), ('2014-06-04', 0.0087382957745571251), ('2014-06-07', 0.0093654541182262713), ('2014-09-11', 0.006437800822945294), ('2014-09-15', 0.0061014024535955133), ('2014-09-24', 0.0066068744528682086)], 701: [('2013-12-27', 0.0033124648692652099)], 190: [('2014-06-11', 0.0087173897059998791)], 196: [('2014-06-30', 0.0054759808448042605), ('2014-07-05', 0.0057322654462242566), ('2014-07-20', 0.0052399937342408574), ('2014-07-26', 0.0053529004901813363), ('2014-07-30', 0.0070548457972069564), ('2014-08-03', 0.0052029390897303119), ('2014-08-09', 0.0054537411313389187), ('2014-08-14', 0.0056217306691945532), ('2014-08-22', 0.0060544079447261926), ('2014-08-27', 0.0046634535981862676), ('2014-08-31', 0.0073043845014396187), ('2014-09-05', 0.0053379377278216025), ('2014-09-11', 0.0047220661696603453)], 59596: [('2014-08-22', 0.005237140181300913), ('2014-08-27', 0.0045433388886386497)], 975: [('2014-09-24', 0.009095463830115235), ('2014-09-26', 0.0053336484676593399)], 1750: [('2013-12-27', 0.0034113154885352659)], 215: [('2014-02-08', 0.008827323675584222), ('2014-02-17', 0.0086794303631172378), ('2014-02-21', 0.004575133631165562), ('2014-02-24', 0.011221872910051238), ('2014-03-03', 0.013076058076008319), ('2014-03-07', 0.010519522426589222), ('2014-03-10', 0.01408315439018144), ('2014-04-07', 0.0088836469853881932), ('2014-04-16', 0.0079334110436461887), ('2014-04-21', 0.010221913271832897), ('2014-04-28', 0.011466772393763374), ('2014-05-03', 0.013621371430654009), ('2014-05-10', 0.0087274678506703424), ('2014-05-17', 0.0057631391665542561), ('2014-05-24', 0.007344353012772295), ('2014-05-29', 0.0096786174652072274), ('2014-06-04', 0.010468555667970537), ('2014-06-07', 0.009110897270926812), ('2014-06-11', 0.0091521403477365787)], 1146: [('2013-12-27', 0.0036322756963153911)], 37: [('2014-10-11', 0.0035774643985149886)], 228: [('2014-09-15', 0.0061107128337383344), ('2014-09-24', 0.0051478563445264795), ('2014-09-26', 0.0040100842984322075), ('2014-09-30', 0.0049188161884255394), ('2014-10-04', 0.0035338579585426108), ('2014-10-08', 0.0071136781224171042), ('2014-10-11', 0.0042008367041613563)], 1000: [('2013-12-27', 0.0045258077646192305)]}

def split_date(date):
    date = date.split('-')
    date = str(date[0]) + '' + (date[1]) + '' + (date[2])
    return date

prev_df = pd.DataFrame()
flag = False
index = 0
for key in d.keys():
    count = 0
    for i in d[key]:
        print(i)
        if i == i:
            count = count + 1
    if count < 7:
        continue
    print(count)
    df = pd.DataFrame(d[key], columns=['date', 'score' + str(index)])
    index = index + 1
    df = df.drop_duplicates(subset='date', keep='first')
    if index == 10:
        print(df)
    df = df.set_index('date')
    #print(df)
    if flag:
        #print(df.columns)
        #print(df.shape)
        #print(df.index)
        #print(prev_df.shape)
        #print(prev_df)
        #print(df)
        prev_df = pd.merge(prev_df, df, how='outer', left_index=True, right_index=True)  
        
    df = prev_df
    flag = True

#print(prev_df)
prev_df = prev_df.reset_index()
prev_df.sort_values(by='date')
prev_df['date'] = prev_df['date'].apply(split_date)
prev_df = prev_df.set_index('date')
prev_df = prev_df.apply(lambda x: np.log10(x))#, axis=1)
prev_df = prev_df.fillna(value='-2.6')
print(prev_df)
#print(prev_df.shape)
#print(prev_df.index)
prev_df.to_csv('user_trajectories.tsv', sep='\t')

